{"version":3,"file":"bundle.js","sources":["../src/help.ts","../src/canvas.ts"],"sourcesContent":["export const getMargin = (i: string) => {\n    // 判断一个字的左右可堆积margin于优先级\n};\n","import { getMargin } from './help';\n\ninterface textConfig {\n    text: string;\n    width: string;\n    fontSize: string;\n    fontFamily: string;\n    lineHeight?: string | number;\n    color: string;\n    padding: string;\n}\nexport default class Canvas {\n    config: textConfig;\n    canvas: HTMLCanvasElement;\n    ctx: CanvasRenderingContext2D;\n    body: HTMLElement;\n\n    constructor(config: textConfig) {\n        this.config = config;\n        this.body = document.body;\n\n        this.canvasInit();\n        this.init();\n        //this.testCaseInit();\n    }\n\n    testCaseInit() {\n        const div = document.createElement('div');\n        const canvasWrap = document.createElement('div');\n        div.innerText = this.config.text;\n        div.style.width = this.config.width;\n        div.style.fontSize = this.config.fontSize;\n        div.style.fontFamily = this.config.fontFamily;\n        div.style.padding = this.config.padding;\n        div.style.color = this.config.color;\n        div.style.border = '1px solid black';\n        div.style.textAlign = 'left';\n\n        canvasWrap.style.width = this.config.width;\n        canvasWrap.style.border = '1px solid black';\n        canvasWrap.style.margin = '20px 0 0 0';\n        canvasWrap.style.textAlign = 'center';\n        canvasWrap.style.fontSize = '0';\n\n        canvasWrap.appendChild(this.canvas);\n        this.body.appendChild(div);\n        this.body.appendChild(canvasWrap);\n    }\n\n    canvasInit() {\n        this.canvas = document.createElement('canvas');\n        this.ctx = this.canvas.getContext('2d');\n        const size = this.init();\n        this.canvas.width = size.width;\n        this.canvas.height = size.height;\n    }\n\n    init() {\n        // 暂定4边padding等宽\n        const startX = parseInt(this.config.padding, 10);\n        const startY = startX;\n        const endX = parseInt(this.config.width, 10) - startX;\n        const getWidth = (val: string) => {\n            this.ctx.save();\n            this.ctx.font = `${this.config.fontSize} ${this.config.fontFamily}`;\n            const height = this.ctx.measureText(val).width;\n            this.ctx.restore();\n            return height;\n        };\n        const getLineHeight = () => {\n            const height = getWidth('w');\n            if (!this.config.lineHeight) {\n                // 不存在\n                return 1.5 * height;\n            }\n            if (typeof this.config.lineHeight === 'number') {\n                return this.config.lineHeight * height;\n            }\n            return parseInt(this.config.lineHeight, 10);\n        };\n        const lineHeight = getLineHeight();\n\n        let beginX = startX;\n        // let beginY = startY + lineHeight;\n        let beginY = startY;\n        this.ctx.save();\n        this.ctx.fillStyle = this.config.color;\n        this.ctx.font = `${this.config.fontSize} ${this.config.fontFamily}`;\n        this.ctx.textBaseline = 'top';\n        let maxWidth = 0;\n        for (const i of this.config.text) {\n            const width = getWidth(i);\n            const eX = beginX + width;\n            const margin = getMargin(i);\n            if (eX > endX) {\n                // console.log(beginX);\n                if (beginX > maxWidth) {\n                    maxWidth = beginX;\n                }\n                beginX = startX;\n                beginY += lineHeight;\n                this.ctx.fillText(i, beginX, beginY);\n                beginX += width;\n            } else {\n                this.ctx.fillText(i, beginX, beginY);\n                beginX = eX;\n            }\n        }\n        this.ctx.restore();\n\n        return {\n            width: maxWidth,\n            height: beginY + startY + lineHeight,\n        };\n    }\n}\n"],"names":["getMargin","i","config","body","document","canvasInit","init","div","createElement","canvasWrap","innerText","text","style","width","fontSize","fontFamily","padding","color","border","textAlign","margin","appendChild","canvas","ctx","getContext","size","height","startX","parseInt","startY","endX","getWidth","val","save","font","_this","measureText","restore","getLineHeight","lineHeight","beginX","beginY","fillStyle","textBaseline","maxWidth","_a","_i","eX","fillText"],"mappings":"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"}