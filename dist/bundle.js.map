{"version":3,"file":"bundle.js","sources":["../src/help.ts","../src/canvas.ts"],"sourcesContent":["export const getMargin = (i: string) => {\r\n    // 判断一个字的左右可堆积margin于优先级\r\n};\r\n","import { getMargin } from './help';\r\n\r\ninterface textConfig {\r\n    text: string;\r\n    width: string;\r\n    fontSize: string;\r\n    fontFamily: string;\r\n    lineHeight?: string | number;\r\n    color: string;\r\n    padding: string;\r\n}\r\nexport default class Canvas {\r\n    config: textConfig;\r\n    canvas: HTMLCanvasElement;\r\n    ctx: CanvasRenderingContext2D;\r\n    body: HTMLElement;\r\n\r\n    constructor(config: textConfig) {\r\n        this.config = config;\r\n        this.body = document.body;\r\n\r\n        this.canvasInit();\r\n        this.init();\r\n        this.testCaseInit();\r\n    }\r\n\r\n    testCaseInit() {\r\n        const div = document.createElement('div');\r\n        const canvasWrap = document.createElement('div');\r\n        div.innerText = this.config.text;\r\n        div.style.width = this.config.width;\r\n        div.style.fontSize = this.config.fontSize;\r\n        div.style.fontFamily = this.config.fontFamily;\r\n        div.style.padding = this.config.padding;\r\n        div.style.color = this.config.color;\r\n        div.style.border = '1px solid black';\r\n        div.style.textAlign = 'left';\r\n\r\n        canvasWrap.style.width = this.config.width;\r\n        canvasWrap.style.border = '1px solid black';\r\n        canvasWrap.style.margin = '20px 0 0 0';\r\n        canvasWrap.style.textAlign = 'center';\r\n        canvasWrap.style.fontSize = '0';\r\n\r\n        canvasWrap.appendChild(this.canvas);\r\n        this.body.appendChild(div);\r\n        this.body.appendChild(canvasWrap);\r\n    }\r\n\r\n    canvasInit() {\r\n        this.canvas = document.createElement('canvas');\r\n        this.ctx = this.canvas.getContext('2d');\r\n        const size = this.init();\r\n        this.canvas.width = size.width;\r\n        this.canvas.height = size.height;\r\n    }\r\n\r\n    init() {\r\n        // 暂定4边padding等宽\r\n        const startX = parseInt(this.config.padding, 10);\r\n        const startY = startX;\r\n        const endX = parseInt(this.config.width, 10) - startX;\r\n        const getWidth = (val: string) => {\r\n            this.ctx.save();\r\n            this.ctx.font = `${this.config.fontSize} ${this.config.fontFamily}`;\r\n            const height = this.ctx.measureText(val).width;\r\n            this.ctx.restore();\r\n            return height;\r\n        };\r\n        const getLineHeight = () => {\r\n            const height = getWidth('w');\r\n            if (!this.config.lineHeight) {\r\n                // 不存在\r\n                return 1.5 * height;\r\n            }\r\n            if (typeof this.config.lineHeight === 'number') {\r\n                return this.config.lineHeight * height;\r\n            }\r\n            return parseInt(this.config.lineHeight, 10);\r\n        };\r\n        const lineHeight = getLineHeight();\r\n\r\n        let beginX = startX;\r\n        // let beginY = startY + lineHeight;\r\n        let beginY = startY;\r\n        this.ctx.save();\r\n        this.ctx.fillStyle = this.config.color;\r\n        this.ctx.font = `${this.config.fontSize} ${this.config.fontFamily}`;\r\n        this.ctx.textBaseline = 'top';\r\n        let maxWidth = 0;\r\n        for (const i of this.config.text) {\r\n            const width = getWidth(i);\r\n            const eX = beginX + width;\r\n            const margin = getMargin(i);\r\n            if (eX > endX) {\r\n                console.log(beginX);\r\n                if (beginX > maxWidth) {\r\n                    maxWidth = beginX;\r\n                }\r\n                beginX = startX;\r\n                beginY += lineHeight;\r\n                this.ctx.fillText(i, beginX, beginY);\r\n                beginX += width;\r\n            } else {\r\n                this.ctx.fillText(i, beginX, beginY);\r\n                beginX = eX;\r\n            }\r\n        }\r\n        this.ctx.restore();\r\n\r\n        return {\r\n            width: maxWidth,\r\n            height: beginY + startY + lineHeight,\r\n        };\r\n    }\r\n}\r\n"],"names":["getMargin","i","config","body","document","canvasInit","init","testCaseInit","div","createElement","canvasWrap","innerText","text","style","width","fontSize","fontFamily","padding","color","border","textAlign","margin","appendChild","canvas","ctx","getContext","size","height","startX","parseInt","startY","endX","getWidth","val","save","font","_this","measureText","restore","getLineHeight","lineHeight","beginX","beginY","fillStyle","textBaseline","maxWidth","_a","_i","eX","log","fillText"],"mappings":"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"}